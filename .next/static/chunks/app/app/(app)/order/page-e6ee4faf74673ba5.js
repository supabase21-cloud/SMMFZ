(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[116],{2926:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>h});var s=t(5155),r=t(2115),i=t(5695),l=t(9576),n=t(3473),d=t(6695),c=t(285),o=t(2523),u=t(5057),m=t(9409),f=t(7481);function h(){let{user:e,refreshUser:a}=(0,l.A)(),t=(0,i.useRouter)(),{toast:h}=(0,f.dj)(),[p,x]=(0,r.useState)([]),[v,y]=(0,r.useState)(""),[j,b]=(0,r.useState)(""),[N,g]=(0,r.useState)(""),[w,S]=(0,r.useState)(""),[k,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e||t.replace("/dashboard")},[e,t]);let E=(0,r.useCallback)(async()=>{x((await (0,n.Z1)()).filter(e=>e.available))},[]);(0,r.useEffect)(()=>{E()},[E]),(0,r.useEffect)(()=>{let e=()=>{"visible"===document.visibilityState&&E()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[E]);let P=(0,r.useMemo)(()=>[...new Set(p.map(e=>e.platform))],[p]),I=(0,r.useMemo)(()=>v?p.filter(e=>e.platform===v):[],[p,v]),z=(0,r.useMemo)(()=>p.find(e=>e.id===j),[p,j]),F=(0,r.useMemo)(()=>z&&"number"==typeof N&&N>0?N*z.price:0,[z,N]),A=e=>{try{return!!RegExp("^(https?://)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}catch(e){return!1}},R=async s=>{if(s.preventDefault(),!z||!e||"number"!=typeof N||N<=0||!w)return void h({title:"Invalid Input",description:"Please fill all fields correctly.",variant:"destructive"});if(!A(w))return void h({title:"Invalid Link",description:"Please provide a valid link.",variant:"destructive"});if(N<z.min||N>z.max)return void h({title:"Invalid Quantity",description:"Quantity must be between ".concat(z.min," and ").concat(z.max,"."),variant:"destructive"});if(e.funds<F)return void h({title:"Insufficient Funds",description:"You do not have enough funds to place this order.",variant:"destructive"});C(!0);let r={userEmail:e.email,serviceId:z.id,quantity:N,link:w},i=await (0,n.wH)(r);C(!1),i?(h({title:"Order Placed!",description:"Your order has been placed successfully."}),await a(),t.push("/dashboard")):h({title:"Order Failed",description:"There was an issue placing your order. Please try again.",variant:"destructive"})};return e?(0,s.jsx)("div",{className:"container mx-auto py-8 flex justify-center",children:(0,s.jsx)(d.Zp,{className:"w-full max-w-2xl",children:(0,s.jsxs)("form",{onSubmit:R,children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsx)(d.ZB,{className:"text-2xl",children:"Place a New Order"}),(0,s.jsx)(d.BT,{children:"Select a service and enter the details below."})]}),(0,s.jsxs)(d.Wu,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u.J,{htmlFor:"platform",children:"Platform"}),(0,s.jsxs)(m.l6,{onValueChange:e=>{y(e),b(""),g("")},value:v,children:[(0,s.jsx)(m.bq,{id:"platform",children:(0,s.jsx)(m.yv,{placeholder:"Select a platform"})}),(0,s.jsx)(m.gC,{children:P.map(e=>(0,s.jsx)(m.eb,{value:e,className:"capitalize",children:e},e))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u.J,{htmlFor:"service",children:"Service"}),(0,s.jsxs)(m.l6,{onValueChange:e=>{b(e);let a=p.find(a=>a.id===e);a&&g(a.min)},value:j,disabled:!v,children:[(0,s.jsx)(m.bq,{id:"service",children:(0,s.jsx)(m.yv,{placeholder:"Select a service"})}),(0,s.jsx)(m.gC,{children:I.map(e=>(0,s.jsx)(m.eb,{value:e.id,className:"capitalize",children:e.type},e.id))})]})]})]}),z&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u.J,{htmlFor:"link",children:"Link"}),(0,s.jsx)(o.p,{id:"link",placeholder:"e.g., https://www.instagram.com/p/C...",value:w,onChange:e=>S(e.target.value),required:!0,disabled:k})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u.J,{htmlFor:"quantity",children:"Quantity"}),(0,s.jsx)(o.p,{id:"quantity",type:"number",placeholder:"Min: ".concat(z.min,", Max: ").concat(z.max),value:N,onChange:e=>g(""===e.target.value?"":Number(e.target.value)),min:z.min,max:z.max,required:!0,disabled:k}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Min: ",z.min," / Max: ",z.max]})]}),(0,s.jsx)(d.Zp,{className:"bg-muted/50",children:(0,s.jsxs)(d.Wu,{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Total Price:"}),(0,s.jsxs)("span",{className:"text-xl font-bold text-primary",children:["$",F.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-2 text-sm text-muted-foreground",children:[(0,s.jsx)("span",{children:"Your current balance:"}),(0,s.jsxs)("span",{children:["$",e.funds.toFixed(2)]})]})]})})]})]}),(0,s.jsx)(d.wL,{children:(0,s.jsx)(c.$,{type:"submit",className:"w-full",disabled:!z||k||!w||!N,children:"Place Order"})})]})})}):null}},4939:(e,a,t)=>{Promise.resolve().then(t.bind(t,2926))},9409:(e,a,t)=>{"use strict";t.d(a,{bq:()=>m,eb:()=>x,gC:()=>p,l6:()=>o,yv:()=>u});var s=t(5155),r=t(2115),i=t(5487),l=t(9556),n=t(7381),d=t(518),c=t(9434);let o=i.bL;i.YJ;let u=i.WT,m=r.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsxs)(i.l9,{ref:a,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[r,(0,s.jsx)(i.In,{asChild:!0,children:(0,s.jsx)(l.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=i.l9.displayName;let f=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.PP,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(n.A,{className:"h-4 w-4"})})});f.displayName=i.PP.displayName;let h=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.wn,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(l.A,{className:"h-4 w-4"})})});h.displayName=i.wn.displayName;let p=r.forwardRef((e,a)=>{let{className:t,children:r,position:l="popper",...n}=e;return(0,s.jsx)(i.ZL,{children:(0,s.jsxs)(i.UC,{ref:a,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...n,children:[(0,s.jsx)(f,{}),(0,s.jsx)(i.LM,{className:(0,c.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(h,{})]})})});p.displayName=i.UC.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.JU,{ref:a,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=i.JU.displayName;let x=r.forwardRef((e,a)=>{let{className:t,children:r,...l}=e;return(0,s.jsxs)(i.q7,{ref:a,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(i.VF,{children:(0,s.jsx)(d.A,{className:"h-4 w-4"})})}),(0,s.jsx)(i.p4,{children:r})]})});x.displayName=i.q7.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.wv,{ref:a,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=i.wv.displayName},9576:(e,a,t)=>{"use strict";t.d(a,{A:()=>c,AuthProvider:()=>d});var s=t(5155),r=t(2115),i=t(2099),l=t(3473);let n=(0,r.createContext)(void 0);function d(e){let{children:a}=e,[t,d]=(0,r.useState)(null),[c,o]=(0,r.useState)(!0),u=(0,r.useCallback)(async e=>{try{let a=await (0,l.wz)(e);d(a)}catch(e){console.error("Error fetching user profile",e),d(null)}},[]),m=(0,r.useCallback)(async()=>{if(null==t?void 0:t.email){o(!0);try{await u(t.email)}catch(e){console.error("Error refreshing user:",e)}finally{o(!1)}}},[t,u]);(0,r.useEffect)(()=>{let e=async(e,a)=>{try{var t;(null==a||null==(t=a.user)?void 0:t.email)?await u(a.user.email):d(null)}catch(e){console.error("Auth state change error:",e)}finally{o(!1)}};(async()=>{o(!0);try{let{data:{session:a},error:t}=await i.N.auth.getSession();t&&"Invalid Refresh Token: Refresh Token Not Found"!==t.message&&console.error("Error getting session:",t),await e("INITIAL_SESSION",a)}catch(e){console.error("Failed to check initial session:",e),d(null)}finally{o(!1)}})();let{data:a}=i.N.auth.onAuthStateChange(async(a,t)=>{("SIGNED_IN"===a||"SIGNED_OUT"===a)&&(o(!0),await e(a,t))});return()=>{a.subscription.unsubscribe()}},[u]);let f=async e=>{let{email:a,password:t}=e;try{let{error:e}=await i.N.auth.signInWithPassword({email:a,password:t});if(e)return{success:!1,error:e.message};return{success:!0}}catch(e){return console.error("Login failed:",e),{success:!1,error:"Failed to fetch. Please check your Supabase credentials in your environment variables."}}},h=async()=>{await i.N.auth.signOut()};return(0,s.jsx)(n.Provider,{value:{user:t,login:f,logout:h,isLoading:c,refreshUser:m},children:a})}let c=()=>{let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var a=a=>e(e.s=a);e.O(0,[647,277,195,543,208,810,213,441,684,358],()=>a(4939)),_N_E=e.O()}]);