(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{2099:(e,r,t)=>{"use strict";t.d(r,{N:()=>i});var s=t(5647);let o="https://vjryvngvrqsxahfrrzyk.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZqcnl2bmd2cnFzeGFoZnJyenlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzMDkzMTAsImV4cCI6MjA2Nzg4NTMxMH0.UtURD4d8oWiVHQlpEoDZM1tsr3D-vWlbEgmU59CUrHc";if(!o||!a)throw Error("Supabase URL and/or anonymous key are not provided. Please check your .env.local file.");let i=(0,s.UU)(o,a)},3473:(e,r,t)=>{"use strict";t.d(r,{AR:()=>i,DY:()=>a,Gm:()=>d,Kv:()=>w,WF:()=>f,Z1:()=>n,bU:()=>u,h1:()=>c,hs:()=>m,lo:()=>p,r3:()=>_,u9:()=>v,wH:()=>y,wz:()=>o});var s=t(2099);let o=async e=>{let{data:r,error:t}=await s.N.from("users").select("*").eq("email",e).single();return t&&"PGRST116"!==t.code?(console.error("Error getting user:",t),null):r},a=async e=>{let{data:r,error:t}=await s.N.auth.signUp({email:e.email,password:e.password});if(t)return console.error("Supabase auth signup error:",t.message),{user:null,error:t.message};if(!r.user)return console.error("Supabase auth signup did not return a user."),{user:null,error:"Could not create user."};let o="user".concat(Math.floor(1e3+9e3*Math.random())),{data:a,error:i}=await s.N.from("users").insert({id:r.user.id,email:e.email,username:o,funds:0}).select().single();return i?(console.error("Error inserting user into database:",i),{user:null,error:"Could not save user profile."}):{user:a}},i=async(e,r)=>{let{data:t,error:o}=await s.N.from("users").update({funds:r}).eq("email",e).select().single();return o?(console.error("Error setting user funds:",o),null):t},n=async()=>{let{data:e,error:r}=await s.N.from("services").select("*").order("platform").order("type");return r?(console.error("Error getting services:",JSON.stringify(r,null,2)),[]):e||[]},l=async e=>{let{data:r,error:t}=await s.N.from("services").select("*").eq("id",e).single();return t?void console.error("Error getting service by ID:",t):r},c=async e=>{let r=e.map(e=>({...e,platform:e.platform.toLowerCase(),type:e.type.toLowerCase(),available:!0,user_cooldown_hours:0===e.price&&e.user_cooldown_hours||0,link_cooldown_hours:0===e.price&&e.link_cooldown_hours||0})),{data:t,error:o}=await s.N.from("services").insert(r).select();return o?(console.error("Error adding services:",o),null):t},u=async(e,r)=>{var t,o;let a={...r,platform:null==(t=r.platform)?void 0:t.toLowerCase(),type:null==(o=r.type)?void 0:o.toLowerCase()};0!==r.price&&(a.user_cooldown_hours=0,a.link_cooldown_hours=0);let{data:i,error:n}=await s.N.from("services").update(a).eq("id",e).select().single();return n?(console.error("Error updating service:",n),null):i},d=async(e,r)=>{let{data:t,error:o}=await s.N.from("services").update({available:r}).eq("id",e).select().single();return o?(console.error("Error updating service availability:",o),null):t},m=async e=>{let{error:r}=await s.N.from("services").delete().eq("id",e);return r?(console.error("Error deleting service:",r),{success:!1,error:r.message}):{success:!0}},f=async()=>{let{data:e,error:r}=await s.N.from("orders").select("*").order("created_at",{ascending:!1});return r?(console.error("Error getting orders:",JSON.stringify(r,null,2)),[]):(null==e?void 0:e.map(e=>({id:e.id,userEmail:e.user_email,username:e.username,serviceId:e.service_id,platform:e.platform,serviceType:e.service_type,quantity:e.quantity,price:e.price,status:e.status,link:e.url,createdAt:e.created_at,comments:Array.isArray(e.comments)?e.comments:null,user_cooldown_hours:e.user_cooldown_hours,link_cooldown_hours:e.link_cooldown_hours})))||[]},y=async e=>{let r=await o(e.userEmail),t=await l(e.serviceId);if(!r||!t||!t.available)return{success:!1,error:"User or service not found, or service is unavailable."};let a=e.quantity*t.price;if(r.funds<a)return{success:!1,error:"Insufficient funds."};if(t.type.toLowerCase().includes("comment")){if(0===e.quantity||!e.comments||0===e.comments.length)return{success:!1,error:"Comments cannot be empty for this service."}}else if(e.quantity<t.min||e.quantity>t.max)return{success:!1,error:"Quantity must be between ".concat(t.min," and ").concat(t.max,".")};if(0===a){let{user_cooldown_hours:r,link_cooldown_hours:o}=t;if(r>0){let t=new Date(Date.now()-60*r*6e4).toISOString(),{data:o,error:a}=await s.N.from("orders").select("created_at").eq("user_email",e.userEmail).eq("price",0).gt("created_at",t).order("created_at",{ascending:!1}).limit(1).single();if(a&&"PGRST116"!==a.code)return console.error("Error checking for recent user free orders:",a),{success:!1,error:"Could not verify free order eligibility."};if(o){let e=new Date(o.created_at).getTime()+60*r*6e4;return{success:!1,error:"You must wait ".concat(r," hour(s) between free orders."),errorType:"USER_COOLDOWN",cooldownExpiry:e}}}if(o>0){let r=new Date(Date.now()-60*o*6e4).toISOString(),{data:t,error:a}=await s.N.from("orders").select("created_at").eq("user_email",e.userEmail).eq("url",e.link).eq("price",0).gt("created_at",r).order("created_at",{ascending:!1}).limit(1).single();if(a&&"PGRST116"!==a.code)return console.error("Error checking for recent link free orders:",a),{success:!1,error:"Could not verify free order eligibility."};if(t)return{success:!1,error:"User is on cooldown for this free service and link.",errorType:"LINK_COOLDOWN",cooldownExpiry:new Date(t.created_at).getTime()+60*o*6e4}}}let n={user_email:e.userEmail,username:r.username,service_id:e.serviceId,platform:t.platform,service_type:t.type,quantity:e.quantity,price:a,url:e.link,status:"Pending",comments:e.comments},{data:c,error:u}=await s.N.from("orders").insert(n).select().single();if(u)return console.error("Error placing order:",JSON.stringify(u,null,2)),{success:!1,error:"Failed to create order in database."};if(a>0){let e=r.funds-a;await i(r.email,e)}return{success:!0,order:{id:c.id,userEmail:c.user_email,username:c.username,serviceId:c.service_id,platform:c.platform,serviceType:c.service_type,quantity:c.quantity,price:c.price,status:c.status,link:c.url,createdAt:c.created_at,comments:Array.isArray(c.comments)?c.comments:null,user_cooldown_hours:t.user_cooldown_hours,link_cooldown_hours:t.link_cooldown_hours}}},w=async(e,r)=>{let{data:t,error:a}=await s.N.from("orders").select("*").eq("id",e).single();if(a||!t)return console.error("Error fetching order to update status:",a),null;if("Pending"!==t.status)return null;if("Cancelled"===r&&t.price>0){let e=await o(t.user_email);if(e){let r=e.funds+t.price;await i(e.email,r)}}let{data:n,error:c}=await s.N.from("orders").update({status:r}).eq("id",e).select().single();if(c){if(console.error("Error updating order status:",c),"Cancelled"===r&&t.price>0){let e=await o(t.user_email);e&&await i(e.email,e.funds-t.price)}return null}let u=await l(n.service_id);return{id:n.id,userEmail:n.user_email,username:n.username,serviceId:n.service_id,platform:n.platform,serviceType:n.service_type,quantity:n.quantity,price:n.price,status:n.status,link:n.url,createdAt:n.created_at,comments:Array.isArray(n.comments)?n.comments:null,user_cooldown_hours:(null==u?void 0:u.user_cooldown_hours)||0,link_cooldown_hours:(null==u?void 0:u.link_cooldown_hours)||0}},p=async()=>{let{data:e,error:r}=await s.N.from("users").select("*");return r?[]:e||[]},_=()=>({instagram:{followers:0,likes:0},tiktok:{followers:0,likes:0},youtube:{followers:0,likes:0}}),v=e=>{}},9576:(e,r,t)=>{"use strict";t.d(r,{A:()=>c,AuthProvider:()=>l});var s=t(5155),o=t(2115),a=t(2099),i=t(3473);let n=(0,o.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,o.useState)(null),[c,u]=(0,o.useState)(!0),d=(0,o.useCallback)(async e=>{try{let r=await (0,i.wz)(e);l(r)}catch(e){console.error("Error fetching user profile",e),l(null)}},[]),m=(0,o.useCallback)(async()=>{if(null==t?void 0:t.email){u(!0);try{await d(t.email)}catch(e){console.error("Error refreshing user:",e)}finally{u(!1)}}},[t,d]);(0,o.useEffect)(()=>{let e=async(e,r)=>{try{var t;(null==r||null==(t=r.user)?void 0:t.email)?await d(r.user.email):l(null)}catch(e){console.error("Auth state change error:",e)}finally{u(!1)}};(async()=>{u(!0);try{let{data:{session:r},error:t}=await a.N.auth.getSession();t&&"Invalid Refresh Token: Refresh Token Not Found"!==t.message&&console.error("Error getting session:",t),await e("INITIAL_SESSION",r)}catch(e){console.error("Failed to check initial session:",e),l(null)}finally{u(!1)}})();let{data:r}=a.N.auth.onAuthStateChange(async(r,t)=>{("SIGNED_IN"===r||"SIGNED_OUT"===r)&&(u(!0),await e(r,t))});return()=>{r.subscription.unsubscribe()}},[d]);let f=async e=>{let{email:r,password:t}=e;try{let{error:e}=await a.N.auth.signInWithPassword({email:r,password:t});if(e)return{success:!1,error:e.message};return{success:!0}}catch(e){return console.error("Login failed:",e),{success:!1,error:"Failed to fetch. Please check your Supabase credentials in your environment variables."}}},y=async()=>{await a.N.auth.signOut()};return(0,s.jsx)(n.Provider,{value:{user:t,login:f,logout:y,isLoading:c,refreshUser:m},children:r})}let c=()=>{let e=(0,o.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9588:(e,r,t)=>{Promise.resolve().then(t.bind(t,9576))}},e=>{var r=r=>e(e.s=r);e.O(0,[647,441,684,358],()=>r(9588)),_N_E=e.O()}]);